<%- include('../../layout/header') %>
<style>
  .infor-staff:hover {
    opacity: 0.7;
    background-color: rgb(45, 145, 227);
    color: white;
  }

  .infor-staff {
    border-bottom: 0.5px solid rgb(77, 211, 229);
  }

  #itemList {
    display: none;
  }

  .itemList {
    display: none;
  }
</style>
<div class="card p-4">
  <div>
    <div class="m-b-30">
      <h4>Danh sách lịch bảo trì trong tháng</strong></h4>
      <div class="tab-pane preview-tab-pane active" role="tabpanel"
        aria-labelledby="tab-dom-da4be276-f13c-47d6-be82-655bc6452fd5"
        id="dom-da4be276-f13c-47d6-be82-655bc6452fd5">
        <div id="tableExample3"
          data-list='{"valueNames":["stt","tencongtrinh","diachi","loaibaotri","thoigian","tongsolanbaotri","tongsolanbaotridadat","tongsolanbaotridathuchien","tongsolanbaotricandat"],"page":20,"pagination":true}'>
          <div class="row justify-content-end g-0">
            <div class="col-auto col-sm-5 mb-3">
              <form>
                <div class="input-group">
                  <input class="form-control form-control-sm shadow-none search"
                    type="search" placeholder="Search..." aria-label="search" />
                  <div class="input-group-text bg-transparent">
                    <span class="fa fa-search fs-10 text-600"></span>
                  </div>
                </div>
              </form>
            </div>
          </div>
          <div class="table-responsive scrollbar">
            <table class="table table-bordered table-hover table-striped fs-10 mb-0" id="maintenanceTable">
              <thead class="bg-200">
                <tr>
                  <th class="text-900 sort" data-sort="stt" style="cursor:pointer;">STT </th>
                  <th class="text-900 sort" data-sort="tencongtrinh" style="cursor:pointer;">Tên công trình </th>
                  <th class="text-900 sort" data-sort="diachi" style="cursor:pointer;">Địa Chỉ </th>
                  <th class="text-900 sort" data-sort="loaibaotri" style="cursor:pointer;">Loại bảo trì </th>
                  <th class="text-900 sort" data-sort="thoigian" style="cursor:pointer;">Thời gian </th>
                  <th class="text-900 sort" data-sort="tongsolanbaotri" style="cursor:pointer;">Tổng số lần bảo trì </th>
                  <th class="text-900 sort" data-sort="tongsolanbaotridadat" style="cursor:pointer;">Số lần đã lên lịch </th>
                  <th class="text-900 sort" data-sort="tongsolanbaotridathuchien" style="cursor:pointer;">Số lần đã thực hiện </th>
                  <th class="text-900 sort" data-sort="tongsolanbaotricandat" style="cursor:pointer;">Số lần chưa lên lịch </th>
                </tr>
              </thead>
              <tbody class="list">
                <%
                  let totalCountMaintenance = 0;
                  let totalCountScheduled = 0;
                  let totalCountPerformed = 0;
                  let totalCountNotScheduled = 0;
                  let totalCountAllActionsStatusNotNull = 0;
                  maintenances.forEach(function(value, key) {
                    totalCountMaintenance += value.countMaintenance || 0;
                    totalCountScheduled += value.maintenance.length || 0;
                    totalCountAllActionsStatusNotNull += value.countMaintenanceAllActionsStatusNotNull || 0;
                    totalCountNotScheduled += (value.countMaintenance - value.maintenance.length) || 0;
                %>
                  <tr>
                    <td class="stt"><%= key + 1 %></td>
                    <td class="tencongtrinh"><%= value.project.full_name %></td>
                    <td class="diachi"><%= value.project.address %></td>
                    <td class="loaibaotri"><%= value.free ? 'Miễn phí' : 'Mất phí' %></td>
                    <td class="thoigian" style="white-space: nowrap;"><%= value.timeStart %> - <%= value.timeEnd %></td>
                    <td class="tongsolanbaotri"><%= value.countMaintenance %></td>
                    <td class="tongsolanbaotridadat"><%= value.maintenance.length %></td>
                    <td class="tongsolanbaotridathuchien"><%= value.countMaintenanceAllActionsStatusNotNull %></td>
                    <td class="tongsolanbaotricandat"><%= value.countMaintenance - value.maintenance.length %></td>
                  </tr>
                <% }); %>
                <!-- Row tổng -->
                <tr style="font-weight:bold; background-color: #77a2b5; color: white;">
                  <td class="stt" colspan="5" style="text-align:right;">Tổng</td>
                  <td class="tongsolanbaotri"><%= totalCountMaintenance %></td>
                  <td class="tongsolanbaotridadat"><%= totalCountScheduled %></td>
                  <td class="tongsolanbaotridathuchien"><%= totalCountAllActionsStatusNotNull %></td>
                  <td class="tongsolanbaotricandat"><%= totalCountNotScheduled %></td>
                </tr>
              </tbody>
            </table>
          </div>
          <div class="d-flex justify-content-center mt-3">
            <button class="btn btn-sm btn-falcon-default me-1" type="button"
              title="Previous" data-list-pagination="prev">
              <span class="fas fa-chevron-left"></span>
            </button>
            <ul class="pagination mb-0"></ul>
            <button class="btn btn-sm btn-falcon-default ms-1" type="button" title="Next"
              data-list-pagination="next">
              <span class="fas fa-chevron-right"> </span>
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
<%- include('../../layout/footer') %>

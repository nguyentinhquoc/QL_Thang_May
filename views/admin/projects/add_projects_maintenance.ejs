<%- include('../../layout/header') %>
<form action="/project/maintenance" method="POST" id="FormAdd">
  <div class="row m-t-15 m-b-15">
    <div class="col-lg-12">
      <div class="card">
        <div class="card-body text-secondary">
          <h2 class="m-b-30">Tạo mới công trình bảo trì</h2>
          <div class="d-flex justify-content-between">
            <div class="form-group col-7">
              <label for="full_name">Tên công trình<span style="color: red">*</span></label>
              <input type="text" placeholder="Enter Name" id="full_name" name="full_name" class="form-control" required maxlength="255"  />
            </div>
            <div class="form-group col-3">
              <label for="code_project">Mã công trình <span style="color: red">*</span></label>
              <input type="text" placeholder="Enter code" id="code_project" name="code_project" class="form-control" required maxlength="255" />
            </div>
          </div>
          <div class="form-group">
            <label for="number_phone">Số điện thoại <span style="color: red">*</span></label>
            <input type="tel" placeholder="Enter Number Phone" id="number_phone" name="number_phone" class="form-control" required maxlength="15"  />
          </div>
          <div class="form-group">
            <label for="email">Địa chỉ email</label>
            <input type="email" placeholder="Enter Address Email" id="email" name="email" class="form-control" maxlength="255" />
          </div>

          <div class="form-group col-12">
            <label for="city">Tỉnh/Thành phố:</label>
            <select required id="city" name="city" class="form-control">
              <option value="" selected disabled>Chọn tỉnh thành</option>
            </select>
          </div>

          <div class="form-group col-12">
            <label for="district">Quận/Huyện:</label>
            <select id="district" name="district" class="form-control">
              <option value="" selected disabled>Chọn quận huyện</option>
            </select>
          </div>

          <div class="form-group col-12">
            <label for="ward">Phường/Xã:</label>
            <select id="ward" name="ward" class="form-control">
              <option value="" selected disabled>Chọn phường xã</option>
            </select>
          </div>

          <div class="form-group">
            <label for="address">Địa chỉ lắp đặt cụ thể <span style="color: red">*</span></label>
            <textarea id="address" placeholder="Enter Address" name="address" class="form-control"></textarea>
          </div>
          <div class="d-flex" style="justify-content: space-between">
            <div class="form-group col-5">
              <label for="price">Giá trị hợp đồng: <span style="color: red">*</span></label>
              <input type="text" placeholder="Nhập giá trị hợp đồng" id="price" class="form-control" onkeyup="formatCurrency(this)" />
              <input type="hidden" id="price_value" name="price" />
              <script>
                function formatCurrency(input) {
                  let value = input.value.replace(/\D/g, '');
                  input.value = value.replace(/\B(?=(\d{3})+(?!\d))/g, '.');
                  document.getElementById('price_value').value = value;
                }
              </script>
            </div>
            <div class="form-group col-5">
              <label for="tax">Thuế:</label>
              <select id="tax" name="tax" class="form-control">
                <option value disabled selected>Chọn</option>
                <option value="Có">Có</option>
                <option value="Không">Không</option>
              </select>
            </div>
          </div>
          <div class="form-group">
            <label for="description">Ghi chú</label>
            <textarea id="description" placeholder="Enter Description" name="description" class="form-control" maxlength="225"></textarea>
          </div>
          <table class="table">
            <thead>
              <tr>
                <th scope="col">Thông tin</th>
                <th scope="col">Giá trị</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td><label for="dongCo">Động cơ</label></td>
                <td>
                  <input type="text" id="dongCo" name="dongCo" class="form-control" />
                </td>
              </tr>
              <tr>
                <td><label for="tuDien">Tủ điện</label></td>
                <td>
                  <input type="text" id="tuDien" name="tuDien" class="form-control" />
                </td>
              </tr>
              <tr>
                <td><label for="capTai">Cáp Tải</label></td>
                <td>
                  <input type="text" id="capTai" name="capTai" class="form-control" />
                </td>
              </tr>
              <tr>
                <td><label for="congSuat">Công suất</label></td>
                <td>
                  <input type="text" id="congSuat" name="congSuat" class="form-control" />
                </td>
              </tr>
              <tr>
                <td><label for="hoThang">Hố thang</label></td>
                <td>
                  <input type="text" id="hoThang" name="hoThang" class="form-control" />
                </td>
              </tr>
              <tr>
                <td><label for="cabin">Cabin</label></td>
                <td>
                  <input type="text" id="cabin" name="cabin" class="form-control" />
                </td>
              </tr>
              <tr>
                <td><label for="cua">Cửa</label></td>
                <td>
                  <input type="text" id="cua" name="cua" class="form-control" />
                </td>
              </tr>
              <tr>
                <td><label for="pit">Pít</label></td>
                <td>
                  <input type="text" id="pit" name="pit" class="form-control" />
                </td>
              </tr>
              <tr>
                <td><label for="oh">OH</label></td>
                <td>
                  <input type="text" id="oh" name="oh" class="form-control" />
                </td>
              </tr>
              <tr>
                <td><label for="phongMay">Phòng máy</label></td>
                <td>
                  <input type="text" id="phongMay" name="phongMay" class="form-control" />
                </td>
              </tr>
            </tbody>
          </table>
          <button class="btn btn-primary btn-lg btn-block mt-3 w-100" onclick="SubmitForm(event)">
            Tạo mới công trình
          </button>
        </div>
      </div>
    </div>
  </div>
</form>


<script src="https://cdnjs.cloudflare.com/ajax/libs/axios/0.21.1/axios.min.js"></script>
<script>
  const host = "https://provinces.open-api.vn/api/";
  var callAPI = (api) => {
    return axios.get(api)
      .then((response) => {
        renderData(response.data, "city");
      });
  }
  callAPI('https://provinces.open-api.vn/api/?depth=1');
  var callApiDistrict = (api) => {
    return axios.get(api)
      .then((response) => {
        renderData(response.data.districts, "district");
      });
  }
  var callApiWard = (api) => {
    return axios.get(api)
      .then((response) => {
        renderData(response.data.wards, "ward");
      });
  }
  var renderData = (array, select) => {
    let row = ' <option disable value="">Chọn</option>';
    array.forEach(element => {
      row += `<option data-id="${element.code}" value="${element.name}">${element.name}</option>`
    });
    document.querySelector("#" + select).innerHTML = row
  }

  $("#city").change(() => {
    callApiDistrict(host + "p/" + $("#city").find(':selected').data('id') + "?depth=2");
    printResult();
  });
  $("#district").change(() => {
    callApiWard(host + "d/" + $("#district").find(':selected').data('id') + "?depth=2");
    printResult();
  });
  $("#ward").change(() => {
    printResult();
  })

  var printResult = () => {
    if ($("#district").find(':selected').data('id') != "" && $("#city").find(':selected').data('id') != "" &&
      $("#ward").find(':selected').data('id') != "") {
      let result = $("#city option:selected").text() +
        " | " + $("#district option:selected").text() + " | " +
        $("#ward option:selected").text();
      $("#result").text(result)
    }
  }
</script>

<%- include('../../layout/footer') %>